!function(a,b){"function"==typeof define&&define.amd?define(["jquery","simplecal"],b):"object"==typeof module&&module.exports?module.exports=b(require("jquery"),require("simplecal")):b(a.jQuery)}(this,function(a){"use strict";function b(b,c){this.options=a.extend({},a.simplecal.defaults,c),this.$input=a(b),this.init()}var c=window.app&&window.app.$window||a(window),d=window.app&&window.app.$document||a(document),e=window.app&&window.app.$body||a("body"),f=0,g=Array.prototype.slice,h="scDate-",i=/,|\.|-| |\/|\\/,j=/d/gi,k=/m/gi,l=/y/gi,m=function(a,b){var c={};return b||(b=function(a){return a}),function(){var d=b.apply(this,arguments);return Object.prototype.hasOwnProperty.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}},n=m(function(a,b){return a.toString().length>b?a:new Array(b-a.toString().length+1).join("0")+a},function(a,b){return a+":"+b}),o=function(a,b){return new Date(b,a,0).getDate()},p=function(a){var b=new Date(a.year,a.month-1,a.day);return b&&b.getMonth()+1===a.month&&b.getDate()===Number(a.day)},q=m(function(a,b){var c=b.match(i)[0],d={},e=a.split(c),f=b.split(c);if(3!==e.length||3!==f.length)return!1;for(var g=0;3>g;g++)f[g].match(j)?d.day=parseInt(e[g],10):f[g].match(k)?d.month=parseInt(e[g],10):f[g].match(l)&&(d.year=parseInt(e[g],10));return p(d)?d:!1},function(a,b){return a+":"+b}),r=m(function(a,b,c,d){var e=d;return e=e.replace(/d+/i,n(a,e.match(j).length)),e=e.replace(/m+/i,n(b,e.match(k).length)),e=e.replace(/y+/i,n(c,e.match(l).length))},function(){return g.call(arguments,0).join(":")});return b.getDateVars=function(a,b){return a instanceof Date?{day:a.getDate(),month:a.getMonth()+1,year:a.getFullYear()}:(b||(b=this.options.dateFormat),q(a,b))},b.formatDate=function(a,b){return a instanceof Date&&(a={day:a.getDate(),month:a.getMonth()+1,year:a.getFullYear()}),b||(b=this.options.dateFormat),r(a.day,a.month,a.year,b)},b.getHtml=function(a,b){a=parseInt(a,10),b=parseInt(b,10);var c=new Date(b,a-1,1).getDay();0===c&&(c=7);var d=new Date(b,a,1),e=new Date(b,a-2,1),f=d.getMonth()+1,g=d.getFullYear(),i=e.getMonth()+1,j=e.getFullYear(),k="<tr>",l=0,m=o(a,b),p=1;l=1>a-1?o(12,b-1):o(a-1,b);for(var q=1;c>q;q++)k+='<td><span class="'+this.options.cellDisabledClass+'">'+(l-c+q+1)+"</span></td>";for(;m>=p;){c>7&&(k+="</tr><tr>",c=1);var r=n(p,2)+"-"+n(a,2)+"-"+n(b,4),s=n(b,4)+"-"+n(a,2)+"-"+n(p,2);k+=new Date(this.options.allowedDates.from)>new Date(s)||new Date(this.options.allowedDates.to)<new Date(s)?'<td><span class="'+this.options.cellDisabledClass+'">'+p+"</span></td>":'<td><a class="'+this.options.cellClass+" "+h+r+'" data-date="'+r+'">'+p+"</a></td>",c++,p++}for(var t=1;8>c;)k+='<td><span class="'+this.options.cellDisabledClass+'">'+t++ +"</span></td>",c++;k+="</tr>";var u=this.options.months[a-1],v=b;if(this.options.changeMonth){for(u='<select class="'+this.options.monthSelectClass+'">',t=0;12>t;t++)u+='<option data-to-year="'+b+'" value="'+(t+1)+'" '+(a-1===t?' selected="selected"':"")+">"+this.options.months[t]+"</option>";u+="</select>"}if(this.options.changeYear){for(v='<select class="'+this.options.yearSelectClass+'">',t=100;t>0;t--)v+='<option value="'+(b-t)+'">'+(b-t)+"</option>";for(v+='<option selected="selected" value="'+b+'">'+b+"</option>",t=1;100>t;t++)v+='<option value="'+(b+t)+'">'+(b+t)+"</option>";v+="</select>"}var w='<div class="meta"><p class="meta_title"><span class="month">'+u+'</span> <span class="year">'+v+'</span></p><a data-to-month="'+i+'" data-to-year="'+j+'" data-current-month="'+a+'" data-current-year="'+b+'" class="'+this.options.monthChangeClass+" "+this.options.prevMonthClass+'"><span>'+this.options.prevMonthText+'</span></a><a data-to-month="'+f+'" data-to-year="'+g+'" data-current-month="'+a+'" data-current-year="'+b+'" class="'+this.options.monthChangeClass+" "+this.options.nextMonthClass+'"><span>'+this.options.nextMonthText+"</span></a></div><table><thead><th>"+this.options.days[0]+"</th><th>"+this.options.days[1]+"</th><th>"+this.options.days[2]+"</th><th>"+this.options.days[3]+"</th><th>"+this.options.days[4]+"</th><th>"+this.options.days[5]+"</th><th>"+this.options.days[6]+"</th></thead><tbody>"+k+"</tbody></table>";return this.options.todayButton&&(w+='<button class="'+this.options.todayButtonClass+'">'+this.options.todayButtonText+"</button>"),w},a.extend(b.prototype,{init:function(){this.$el=a("<div>").addClass(this.options.calendarClass),this.$calEl=a("<div>").addClass(this.options.calendarClass+"Inner").appendTo(this.$el),this.opened=!1,this.ens=".simplecal"+ ++f,this.inputDateValBackup=this.getInputDateVal(),this.$input.data("class")&&this.$el.addClass(this.$input.data("class")),this.$input.data("date-format")&&(this.options.dateFormat=this.$input.data("date-format")),this.$input.data("time-step")&&(this.options.timeStep=parseInt(this.$input.data("time-step"),10)),this.$input.data("change-month")&&(this.options.changeMonth=!0),this.$input.data("change-year")&&(this.options.changeYear=!0),"undefined"!=typeof this.$input.data("show-seconds")&&(this.options.showSeconds=!!this.$input.data("show-seconds")),this.options.attached&&(this.showCalendar(),this.$el.addClass(this.options.attachedClass)),this.options.mobileBreakpoint&&c.outerWidth()<=this.options.mobileBreakpoint&&this.setReadonly(!0),this.options.timepicker&&this.setupTimePicker(),this.events()},getInputDateVal:function(){var a=this.$input.val();return a.length?this.options.timepicker?a.split(" ")[0]:a:""},setInputDateVal:function(a){return this.$input.val(this.options.timepicker?a+" "+this.formatTime(parseInt(this.$inputTime.val(),10)):a),this},getInputTimeVal:function(){var a=this.$input.val();return 0!==a.length?a.split(" ")[1]:this.formatTime(0)},setInputTimeVal:function(a){return this.$input.val(this.$input.val().split(" ")[0]+" "+a),this},events:function(){var b="."+this.options.cellClass.split(" ").join("."),c="."+this.options.monthChangeClass.split(" ").join(".");this.$input.on("focus"+this.ens+" click"+this.ens,a.proxy(this.onFocus,this)).on("change"+this.ens,a.proxy(this.setupMarkers,this)).on("keyup"+this.ens,a.proxy(this.onKeyup,this)),this.$el.on("click"+this.ens,b,a.proxy(this.onSelectDate,this)),this.$el.on("click"+this.ens,c,a.proxy(this.onChangeMonth,this)),this.options.changeMonth&&this.$el.on("change"+this.ens,"."+this.options.monthSelectClass.split(" ").join("."),a.proxy(this.onMonthSelect,this)),this.options.changeYear&&this.$el.on("change"+this.ens,"."+this.options.yearSelectClass.split(" ").join("."),a.proxy(this.onYearSelect,this)),this.options.todayButton&&this.$el.on("click"+this.ens,"."+this.options.todayButtonClass.split(" ").join("."),a.proxy(this.onClickTodayButton,this)),this.$el.on("show",a.proxy(this.onShow,this)),this.$el.on("close",a.proxy(this.onClose,this))},onFocus:function(){this.validateInput()&&this.showCalendar()},onKeyup:function(b){if(!(a.inArray(b.keyCode,[37,38,39,40,16,27])>=0)&&this.validateInput()){var c=0===this.getInputDateVal().length?this.getDateVars(new Date):this.getDateVars(this.getInputDateVal());this.$calEl.html(this.getCalendarHtml(c.month,c.year)),this.setupMarkers()}},onSelectDate:function(b){var c=this.formatDate(this.getDateVars(a(b.target).data("date"),"dd-mm-yyyy"));this.setInputDateVal(c).$input.trigger("change"),this.options.attached||this.close()},onChangeMonth:function(b){var c=a(b.currentTarget);return this.$calEl.html(this.getCalendarHtml(c.data("to-month"),c.data("to-year"))),this.setupMarkers(),this.options.attached||this.setupPosition(),!1},onMonthSelect:function(b){var c=a(b.currentTarget),d=c.find(":selected");return this.$calEl.html(this.getCalendarHtml(d.val(),d.data("to-year"))),this.setupMarkers(),this.options.attached||this.setupPosition(),!1},onYearSelect:function(b){var c=a(b.currentTarget),d=c.find(":selected");return this.$calEl.html(this.getCalendarHtml(1,d.val())),this.setupMarkers(),this.options.attached||this.setupPosition(),!1},onClickTodayButton:function(a){a.preventDefault(),this.setDate(new Date,this.options.format)},onShow:function(){var b=this;this.$input.addClass(this.options.inputActiveClass),b.options.attached||(c.on("resize"+this.ens,function(){b.setupPosition()}),setTimeout(function(){d.on("click"+b.ens+" focusout"+b.ens+" keyup"+b.ens,function(c){return 27===c.keyCode&&b.opened?void b.close():void(!a(c.target).is(b.$input)&&!a.contains(b.$el[0],c.target)&&b.close())})},0))},onClose:function(){this.$input.removeClass(this.options.inputActiveClass),d.off(this.ens),c.off(this.ens)},setReadonly:function(a){this.$input[0].readOnly=a},validateInput:function(){var a=this.getInputDateVal();return 0===a.length||this.getDateVars(a)?(this.$input.removeClass(this.options.calendarClass+"_invalid"),this.inputDateValBackup=a,!0):(this.$input.addClass(this.options.calendarClass+"_invalid"),this.options.disableInvalidInput&&this.setInputDateVal(this.inputDateValBackup),!1)},showCalendar:function(){if(!this.opened){this.opened=!0;var a=0===this.getInputDateVal().length?this.getDateVars(new Date):this.getDateVars(this.getInputDateVal());this.$calEl.html(this.getCalendarHtml(a.month,a.year)),this.setupMarkers(),this.options.attached?this.$attachCont||(this.$attachCont="string"==typeof this.options.attached?this.$input.closest(this.options.attached):this.$input.parent(),this.$el.appendTo(this.$attachCont)):(this.$el.appendTo(e),this.setupPosition(),this.$el.trigger("show"))}},close:function(){this.opened&&(this.opened=!1,this.$el.detach().trigger("close"))},setupMarkers:function(){this.$el.find("."+this.options.dateActiveClass).removeClass(this.options.dateActiveClass);var a=function(a){return"."+h+n(a.day,2)+"-"+n(a.month,2)+"-"+n(a.year,4)};this.$el.find(a(this.getDateVars(new Date))).addClass(this.options.dateTodayClass),this.getInputDateVal().length&&this.$el.find(a(this.getDateVars(this.getInputDateVal()))).addClass(this.options.dateActiveClass)},setupPosition:function(){var a=c.outerHeight(),b=c.outerWidth(),d=this.$input.offset(),e=this.$input.outerHeight(),f=this.$input.outerWidth();if(this.options.mobileBreakpoint&&b<=this.options.mobileBreakpoint)return this.setReadonly(!0),void this.$el.attr("style","").addClass(this.options.calendarMobileClass).css({top:d.top+e});this.$el.removeClass(this.options.calendarClass+"_mobile");var g=this.$el.outerWidth(),h=this.$el.outerHeight(),i={};g+d.left>b?(i.left=d.left-(g-f),i.top=d.top+e):h+d.top+e>a+c.scrollTop()?(i.left=d.left,i.top=d.top-h):i={left:d.left,top:d.top+e},this.$el.css(i)},incrementDate:function(a){var b=this.getDateVars(this.getInputDateVal()),c=new Date(b.year,b.month-1,b.day);return this.setDate(new Date(c.getTime()+864e5*a))},setDate:function(a,b){return this.setInputDateVal(this.formatDate(this.getDateVars(a,b))).$input.trigger("change"),this},setupTimePicker:function(){this.$timeEl=a("<div>").addClass(this.options.timeElClass).appendTo(this.$el),this.$timePreview=a("<div>").addClass(this.options.timePreviewClass).appendTo(this.$timeEl);var b=this.getInputTimeVal(),c=b.length?this.parseTime(b):0;this.$inputTime=a("<input>").val(c).appendTo(this.$timeEl).simpleRangeSlider(a.extend({maxVal:86399,step:this.options.timeStep,onUpdateView:a.proxy(function(a){var b=this.formatTime(parseInt(a,10));this.$timePreview.text(b),0!==this.$input.val().length&&this.setInputTimeVal(b)},this)},this.options.rangeSliderOptions)).on("change",a.proxy(function(){this.$input.trigger("change")},this)),this.rangeSliderApi=this.$inputTime.data("simpleRangeSlider")},formatTime:function(a){var b=Math.floor(a/3600),c=Math.floor((a-60*b*60)/60),d=a-60*b*60-60*c;return n(b,2)+":"+n(c,2)+(this.options.showSeconds?":"+n(d,2):"")},parseTime:function(b){var c=0;return a.each(b.split(":"),function(a,b){c+=Math.pow(60,2-a)*b}),c},destroy:function(){this.$input.off(this.ens).removeClass(this.options.inputActiveClass),c.off(this.ens),d.off(this.ens),this.rangeSliderApi&&this.rangeSliderApi.destroy(),this.$el.empty().remove(),delete this.$el.data().simplecal},getDateVars:b.getDateVars,getCalendarHtml:b.getHtml,formatDate:b.formatDate}),a.fn.simplecal=function(c){return this.each(function(){a.data(this,"simplecal")||a.data(this,"simplecal",new b(this,c))})},a.Simplecal=a.simplecal=b,a.Simplecal.defaults={dateFormat:"dd.mm.yyyy",attached:!1,mobileBreakpoint:null,disableInvalidInput:!1,calendarClass:"simplecal",calendarMobileClass:"simplecal_mobile",cellClass:"simplecal_cell",cellDisabledClass:"simplecal_disabled",inputActiveClass:"active",attachedClass:"attached",dateActiveClass:"selected",dateTodayClass:"today",monthChangeClass:"month_control",nextMonthClass:"next",prevMonthClass:"prev",monthSelectClass:"sc_month_select",yearSelectClass:"sc_year_select",changeMonth:!1,changeYear:!1,todayButton:!1,todayButtonClass:"todayBtn",todayButtonText:"Today",allowedDates:!1,timepicker:!1,timeElClass:"simplecal_time",timePreviewClass:"simplecal_time_preview",timeStep:300,showSeconds:!0,rangeSliderOptions:{},prevMonthText:"Previous month",nextMonthText:"Next month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Mo","Tu","We","Th","Fr","Sa","Su"]},a});